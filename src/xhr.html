<!doctype html>
<html>
    <head>
        <title>easyXDM cross-domain XHMLHttpRequest provider</title>
        <script type="text/javascript" src="easyXDM.debug.js">
            // This should be changed so that it points to the minified version before use in production.
        </script>
        <script type="text/javascript">
            // Update to point to your copy
            easyXDM.DomHelper.requiresJSON("json2.js");
        </script>
        <script type="text/javascript">
            if (!'XMLHttpRequest' in window) {
                window.XMLHttpRequest = (function(){
                    var item, list = ["Microsoft.XMLHTTP", "Msxml2.XMLHTTP", "Msxml3.XMLHTTP"], i = list.length;
                    while (i--) {
                        try {
                            item = list[i];
                            var obj = new ActiveXObject(item);
                            // we are still here!
                            obj = list = null;
                            return function(){
                                return new ActiveXObject(item);
                            };
                        } 
                        catch (e) {
                        }
                    }
                })();
            }
            
            function ajax(url, data, fn){
                var req = new XMLHttpRequest(), q;
                req.open("POST", url, true);
                req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                req.setRequestHeader("X-Requested-With", "XMLHttpRequest");
                req.onreadystatechange = function(){
                    if (req.readyState == 4) {
                        req.onreadystatechange = null;
                        delete req.onreadystatechange;
                        if (req.status >= 200 && req.status < 300) {
                            var contentType = req.getResponseHeader("Content-Type");
                            if (contentType.startsWith("application/json")) {
                                fn(JSON.parse(req.responseText));
                            }
                            else {
                                alert("Invalid content type: " + contentType);
                            }
                        }
                        else {
                            alert("An error occured. Status code: " + req.status);
                        }
                    }
                };
                
                for (var key in data) {
                    if (data.hasOwnProperty(key)) {
                        q.push(key + "=" + encodeURIComponent(data[key]));
                    }
                }
                req.send(q.join("&"));
            }
            
            window.onload = function(){
                var remote = new easyXDM.Rpc({
                    local: "name.html"
                }, {
                    local: {
                        post: {
                            isAsync: true,
                            method: ajax
                        }
                    }
                });
            };
        </script>
    </head>
    <body>
    </body>
</html>
