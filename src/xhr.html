<!doctype html>
<html>
    <head>
        <title>easyXDM cross-domain XHMLHttpRequest provider</title>
        <script type="text/javascript" src="easyXDM.debug.js">
        	// This should be changed so that it points to the minified version before use in production.
        </script>
        <script type="text/javascript">
        	// Update to point to your copy
            easyXDM.DomHelper.requiresJSON("json2.js");
        </script>
        <script type="text/javascript">
            
            function createXMLHTTPObject(){
                var xmlHttp, XMLHttpFactories = [function(){
                    return new ActiveXObject("Microsoft.XMLHTTP");
                }, function(){
                    return new ActiveXObject("Msxml3.XMLHTTP");
                }, function(){
                    return new ActiveXObject("Msxml2.XMLHTTP");
                }, function(){
                    return new XMLHttpRequest();
                }
            ], i = XMLHttpFactories.length;
                
                if (this._factory) {
                    return this._factory();
                }
                while (i--) {
                    try {
                        xmlHttp = XMLHttpFactories[i]();
                        // Use memoization to cache the factory
                        this._factory = XMLHttpFactories[i];
                        return xmlHttp;
                    } 
                    catch (e) {
                    }
                }
            }
            
            window.onload = function(){
                var remote = new easyXDM.Rpc({
                    local: "hash.html"
                }, {
                    local: {
                        post: {
                            isAsync: true,
                            method: function(url, data, fn){
                                // You really should add some filtering to only allow certain url's
                                var xhrObj = createXMLHTTPObject();
                                xhrObj.onreadystatechange = function(){
                                    if (xhrObj.readyState === 4 && xhrObj.status === 200) {
                                        fn(JSON.parse(xhrObj.responseText));
                                    }
                                };
                                xhrObj.open('POST', url, true);
                                xhrObj.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                                var encodedData = easyXDM.Url.appendQueryParameters("", data).substring(1);
                                xhrObj.send(encodedData);
                            }
                        }
                    }
                });
            };
        </script>
    </head>
    <body>
    </body>
</html>
