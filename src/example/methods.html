<!doctype html>
<html>
    <head>
        <title>easyXSS</title>
        <script type="text/javascript" src="../easyXSS.debug.js">
        </script>
        <script type="text/javascript">
            /**
             * Request the use of the JSON object
             */
            easyXSS.DomHelper.requiresJSON("../json2.js");
        </script>
        <script type="text/javascript">
            var remote;
            window.onload = function(){
                /**
                 * When the window is finished loading start setting up the interface
                 */
                remote = new easyXSS.Interface(/** The channel configuration */{
                    /**
                     * Register the url to hash.html, this must be an absolute path
                     * or a path relative to the root.
                     * @field
                     */
                    local: "/hash.html",
                    /**
                     * Register the url to the remote interface
                     * @field
                     */
                    remote: "http://provider.easyxss.net/example/remotemethods.html",
                    /**
                     * Register the DOMElement that the generated IFrame should be inserted into
                     */
                    container: document.getElementById("embedded")
                }, /** The interface configuration */ {
                    remote: {
                        addNumbers: {},
                        multiplyNumbers: {},
                        noOp: {
                            isVoid: true
                        }
                    },
                    local: {
                        alertMessage: {
                            method: function(msg){
                                alert(msg);
                            },
                            isVoid: true
                        }
                    }
                },/**The onReady handler*/ function(){
                    /**
                     * Call a method on the other side
                     */
                    remote.noOp();
                });
            }
            
            function add(a, b){
                remote.addNumbers(a, b, function(result){
                    alert(a + " + " + b + " = " + result);
                });
            }
            
            function multiply(a, b){
                remote.multiplyNumbers(a, b, function(result){
                    alert(a + " x " + b + " = " + result);
                })
            }
        </script>
        <style type="text/css">
            #embedded {
                height: 200px;
            } #embedded iframe {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body>
        <script type="text/javascript">
            document.write("Domain: " + location.host);
        </script>
        <!-- easyXSS.Debug.trace(msg) will output its messages to any element with the id "log" -->
        <div id="log" style="height:100px;border:1px dotted black;overflow:auto">
        </div>
        <div id="embedded">
        </div>
        <div>
            The remote implementation is synchronous and will return immediately
            <br/>
            <input type="button" onclick="add(3,5)" value="call addNumbers on remote domain"/>
            <br/>
            <br/>
            The remote implementation of multiplyNumbers is asynchronous and will return after 5seconds
            <br/>
            This shows that you can use async calls in the remote method, eg. XHR calls
            <br/>
            <input type="button" onclick="multiply(3,5)" value="call multiplyNumbers on remote domain"/>
            <br/>
            <br/>
            This calls a non-returning method on the remote side
            <br/>
            <input type="button" onclick="remote.noOp()" value="call noOp on the remote domain"/>
        </div>
    </body>
</html>