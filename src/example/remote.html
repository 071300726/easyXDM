<!doctype html>
<html>
    <head>
        <title>easyXSS</title>
        <script type="text/javascript" src="../easyXSS.debug.js">
        </script>
        <script type="text/javascript">
            easyXSS.DomHelper.requiresJSON("../json2.js");
        </script>
        <script type="text/javascript">
            /* This window can use window.open() to open up a new window in its own domain.
             * These two will be able to communicate directly, meaning that we now have two
             * windows visible to the user that are able to communicate
             * It can also run XHR-queries the local domain that can be returned to the other side of the proxy.
             */
            var proxy;
            var remoteapp;
            window.onload = function(){
                remoteapp = window.open('remoteapp.html', 'mainapp', 'width=300,height=300');
                if (remoteapp) {
                    proxy = easyXSS.createChannel({
                        onData: function(data, origin){
                            remoteapp.focus();
                            var div = remoteapp.document.createElement("div");
                            div.innerHTML = "data from '" + origin + "'";
                            remoteapp.document.body.appendChild(div);
                            for (key in data) {
                                var div = remoteapp.document.createElement("div");
                                div.innerHTML = key + "=" + data[key];
                                remoteapp.document.body.appendChild(div);
                            }
                        },
                        converter: JSON
                    });
                }
                else {
                    alert("you need to allow opening popups for this to work");
                }
            }
        </script>
    </head>
    <body>
    </body>
</html>
