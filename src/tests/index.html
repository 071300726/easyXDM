<!doctype html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
        <title>easyTest results</title>
        <script type="text/javascript" src="../easyXDM.debug.js">
            //Is not executed, but makes jslint validate
            var easyXDM, JSON, _gat;
        </script>
        <script type="text/javascript">
            if (typeof JSON === "undefined") {
                document.write(unescape("%3Cscript src='../json2.js' type='text/javascript'%3E%3C/script%3E"));
            }
        </script>
        <script type="text/javascript" src="easyTest.js">
            //Is not executed, but makes jslint validate
            var easyTest;
        </script>
        <link type="text/css" rel="stylesheet" href="easyTest.css"/>
        <script type="text/javascript">
            var _remoteUrl = location.href.substring(0, location.href.lastIndexOf("/") + 1);
            function runTests(){
                easyTest.test([/**Tests for the presence of namespaces and classes*/{
                    name: "Check that the library is complete",
                    steps: [{
                        name: "check for the presence of easyXDM",
                        run: function(){
                            return (typeof easyXDM === "object");
                        }
                    }, {
                        name: "check for the presence of easyXDM.transport",
                        run: function(){
                            return (typeof easyXDM.transport === "object");
                        }
                    }, {
                        name: "check for the presence of easyXDM.serializing",
                        run: function(){
                            return (typeof easyXDM.serializing === "object");
                        }
                    }, {
                        name: "check for the presence of easyXDM.configuration",
                        run: function(){
                            return (typeof easyXDM.configuration === "object");
                        }
                    }, {
                        name: "check for the presence of easyXDM.Channel",
                        run: function(){
                            return (typeof easyXDM.Channel === "function");
                        }
                    }, {
                        name: "check for the presence of easyXDM.transport.HashTransport",
                        run: function(){
                            return (typeof easyXDM.transport.HashTransport === "function");
                        }
                    }, {
                        name: "check for the presence of easyXDM.transport.PostMessageTransport",
                        run: function(){
                            return (typeof easyXDM.transport.PostMessageTransport === "function");
                        }
                    }, {
                        name: "check for the presence of easyXDM.Debug",
                        run: function(){
                            return (typeof easyXDM.Debug === "object");
                        }
                    }, {
                        name: "check for the presence of easyXDM.DomHelper",
                        run: function(){
                            return (typeof easyXDM.DomHelper === "object");
                        }
                    }, {
                        name: "check for the presence of easyXDM.Url",
                        run: function(){
                            return (typeof easyXDM.Url === "object");
                        }
                    }]
                }, /** easyXDM.transport.HashTransport*/ {
                    name: "test easyXDM.transport.HashTransport using polling",
                    steps: [{
                        name: "onReady is fired",
                        timeout: 5000,
                        run: function(){
                            /** -----------------------------*/
                            var scope = this;
                            this.transport = new easyXDM.transport.HashTransport({
                                channel: "default",
                                local: "../hash.html",
                                remote: _remoteUrl + "test_hashtransport.html",
                                onMessage: function(message, origin){
                                    scope.notifyResult((scope.expectedMessage === message));
                                },
                                container: document.getElementById("embedded")
                            }, function(){
                                scope.notifyResult(true);
                            });
                            /** -----------------------------*/
                        }
                    }, {
                        name: "message is echoed back",
                        timeout: 1000,
                        run: function(){
                            this.expectedMessage = "abcd1234";
                            this.transport.postMessage(this.expectedMessage);
                        }
                    }, {
                        name: "destroy",
                        run: function(){
                            this.transport.destroy();
                            return ((document.getElementsByTagName("iframe").length === 0));
                        }
                    }]
                },{
                    name: "test easyXDM.transport.HashTransport using onresize",
                    steps: [{
                        name: "onReady is fired",
                        timeout: 5000,
                        run: function(){
                            /** -----------------------------*/
                            var scope = this;
                            this.transport = new easyXDM.transport.HashTransport({
                                channel: "default",
                                local: "../hash.html",
                                remote: _remoteUrl + "test_hashtransport.html",
                                onMessage: function(message, origin){
                                    scope.notifyResult((scope.expectedMessage === message));
                                }
                            }, function(){
                                scope.notifyResult(true);
                            });
                            /** -----------------------------*/
                        }
                    }, {
                        name: "message is echoed back",
                        timeout: 1000,
                        run: function(){
                            this.expectedMessage = "abcd1234";
                            this.transport.postMessage(this.expectedMessage);
                        }
                    }, {
                        name: "destroy",
                        run: function(){
                            this.transport.destroy();
                            return ((document.getElementsByTagName("iframe").length === 0));
                        }
                    }]
                },{
                    name: "test easyXDM.transport.PostMessageTransport",
                    steps: [{
                        name: "onReady is fired",
                        timeout: 5000,
                        run: function(){
                            /** -----------------------------*/
                            var scope = this;
                            this.transport = new easyXDM.transport.PostMessageTransport({
                                channel: "default",
                                local: "../hash.html",
                                remote: _remoteUrl + "test_postmessagetransport.html",
                                onMessage: function(message, origin){
                                    scope.notifyResult((scope.expectedMessage === message));
                                }
                            }, function(){
                                scope.notifyResult(true);
                            });
                            /** -----------------------------*/
                        }
                    }, {
                        name: "message is echoed back",
                        timeout: 1000,
                        run: function(){
                            this.expectedMessage = "abcd1234";
                            this.transport.postMessage(this.expectedMessage);
                        }
                    }, {
                        name: "destroy",
                        run: function(){
                            this.transport.destroy();
                            return ((document.getElementsByTagName("iframe").length === 0));
                        }
                    }]
                },{
                    name: "test easyXDM.transport.BestAvailableTransport",
                    steps: [{
                        name: "onReady is fired",
                        timeout: 5000,
                        run: function(){
                            /** -----------------------------*/
                            var scope = this;
                            this.transport = new easyXDM.transport.BestAvailableTransport({
                                channel: "default",
                                local: "../hash.html",
                                remote: _remoteUrl + "test_bestavailabletransport.html",
                                onMessage: function(message, origin){
                                    scope.notifyResult((scope.expectedMessage === message));
                                }
                            }, function(){
                                scope.notifyResult(true);
                            });
                            /** -----------------------------*/
                        }
                    }, {
                        name: "message is echoed back",
                        timeout: 1000,
                        run: function(){
                            this.expectedMessage = "abcd1234";
                            this.transport.postMessage(this.expectedMessage);
                        }
                    }, {
                        name: "destroy",
                        run: function(){
                            this.transport.destroy();
                            return ((document.getElementsByTagName("iframe").length === 0));
                        }
                    }]
                },{
                    name: "test easyXDM.transport.BestAvailableTransport with query parameters",
                    steps: [{
                        name: "onReady is fired",
                        timeout: 5000,
                        run: function(){
                            /** -----------------------------*/
                            var scope = this;
                            this.transport = new easyXDM.transport.BestAvailableTransport({
                                channel: "default",
                                local: "../hash.html",
                                remote: _remoteUrl + "test_bestavailabletransport.html?a=b&c=d",
                                onMessage: function(message, origin){
                                    scope.notifyResult((scope.expectedMessage === message));
                                }
                            }, function(){
                                scope.notifyResult(true);
                            });
                            /** -----------------------------*/
                        }
                    }, {
                        name: "message is echoed back",
                        timeout: 1000,
                        run: function(){
                            this.expectedMessage = "abcd1234";
                            this.transport.postMessage(this.expectedMessage);
                        }
                    }, {
                        name: "destroy",
                        run: function(){
                            this.transport.destroy();
                            return ((document.getElementsByTagName("iframe").length === 0));
                        }
                    }]
                }, /** easyXDM.Interface*/ {
                    name: "test easyXDM.Interface",
                    steps: [{
                        name: "onReady is fired",
                        timeout: 5000,
                        run: function(){
                            /** -----------------------------*/
                            var scope = this;
                            this.remote = new easyXDM.Interface({
                                local: "../hash.html",
                                remote: _remoteUrl + "test_interface.html",
                                container: document.getElementById("embedded")
                            }, {
                                remote: {
                                    voidMethod: {
                                        isVoid: true
                                    },
                                    asyncMethod: {},
                                    method: {}
                                },
                                local: {
                                    voidCallback: {
                                        method: function(message){
                                            scope.notifyResult((scope.expectedMessage === message));
                                        },
                                        isVoid: true
                                    }
                                }
                            }, function(){
                                scope.notifyResult(true);
                            });
                            /** -----------------------------*/
                        }
                    }, {
                        name: "void method",
                        timeout: 1000,
                        run: function(){
                            this.expectedMessage = "abcd1234";
                            this.remote.voidMethod(this.expectedMessage);
                        }
                    }, {
                        name: "async method",
                        timeout: 1000,
                        run: function(){
                            var scope = this;
                            this.expectedMessage = "abcd1234";
                            this.remote.asyncMethod(this.expectedMessage, function(message){
                                scope.notifyResult((scope.expectedMessage === message));
                            });
                        }
                    }, {
                        name: "regular method",
                        timeout: 1000,
                        run: function(){
                            var scope = this;
                            this.expectedMessage = "abcd1234";
                            this.remote.method(this.expectedMessage, function(message){
                                scope.notifyResult((scope.expectedMessage === message));
                            });
                        }
                    }, {
                        name: "destroy",
                        run: function(){
                            this.remote.destroy();
                            return ((document.getElementsByTagName("iframe").length === 0));
                        }
                    }]
                }]);
            }
        </script>
        <style type="text/css">
            
            #embedded {
                height: 100px;
            }
            
            #embedded iframe {
                height: 90px;
            }
        </style>
    </head>
    <body onload="runTests();"><!-- easyXDM.Debug.trace(msg) will output its messages to any element with the id "log" -->
        <div id="log" style="height:100px;border:1px dotted black;overflow:auto">
        </div>
        <div id="embedded">
        </div>
        <div id="messages">
        </div>
        <script type="text/javascript">
            if (location.host.indexOf("easyxdm.net") !== -1) {
                var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
                document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
            }
        </script>
        <script type="text/javascript">
            if (location.host.indexOf("easyxdm.net") !== -1) {
                try {
                    var pageTracker = _gat._getTracker("UA-9535591-3");
                    pageTracker._setDomainName(".easyxdm.net");
                    pageTracker._trackPageview();
                } 
                catch (err) {
                }
            }
        </script>
    </body>
</html>
