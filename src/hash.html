<!doctype html>
<html>
    <head>
        <title></title>
        <meta http-equiv="CACHE-CONTROL" content="PUBLIC"/>
        <meta http-equiv="EXPIRES" content="Sat, 01 Jan 2050 00:00:00 GMT"/>
        <style type="text/css">
            html, body {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body>
        <script type="text/javascript">
            var channel, callback;
            window.sendMessage = function(message, url){
                window.setTimeout(function(){
                    window.name = message;
                    location.href = url;
                }, 0);
            };
            
            function onResize(){
                if (!callback) {
                    callback = window.parent.parent.easyXDM.Fn.get(channel + "_onresize");
                }
                callback(location.hash);
            }
            
            if (location.hash) {
                if (location.hash.substring(1, 2) === "_") {
                    switch (location.hash.substring(2, 3)) {
                        case "2":
                            // NameTransport local
                            channel = location.hash.substring(3);
                            window.parent.parent.easyXDM.Fn.get(channel)(window.name);
                            window.history.back();
                            break;
                        case "3":
                            // NameTransport remote
                            var url = decodeURIComponent(location.hash.substring(3)), guest;
                            channel = url.substring(url.indexOf("#") + 1);
                            try {
                                // This works in IE
                                guest = window.parent.frames[channel];
                            } 
                            catch (ex) {
                                guest = window.open("", channel);
                            }
                            guest.easyXDM.Fn.get(channel)(window.name);
                            window.history.back();
                            break;
                        case "4":
                            // NameTransport idle
                            var fn = window.parent.easyXDM.Fn.get(location.hash.substring(3) + "_load");
                            if (fn) {
                                fn();
                            }
                    }
                }
                else {
                    // The old HashTransport
                    channel = location.hash.substring(1);
                    window.parent.parent.easyXDM.stack.HashTransport.channelReady(channel, window);
                    
                    if (window.addEventListener) {
                        window.addEventListener('resize', onResize, false);
                    }
                    else if (document.body.attachEvent) {
                        window.onresize = onResize;
                    }
                }
            }
        </script>
    </body>
</html>
